## 基础图（蜡烛图）、TradingView、深度图
1. 基础图：用于展示资产价格的历史走势，其功能相对简单，数据主要来自交易所自身的交易数据记录，可定制度较低
2. TradingView：提供更丰富的技术分析指标（如移动平均线、RSI、MACD 等），支持自定义图表布局，用户可根据需求添加或移除指标，不仅可以获取交易所的交易数据，还能汇聚全球多个市场的数据，可定制度高
3. 深度图：展示资产价格的深度分布，即展示不同价格水平上的订单量（买盘量与卖盘量），帮助用户了解市场供需情况，同时也可以用于识别潜在的交易机会。

## 项目背景
针对千万级日活的数字资产交易平台，聚焦核心交易页（覆盖现货、合约等多场景）存在高频数据更新延迟、组件重渲染冗余、交互响应卡顿等问题，牵头主导核心交易页性能极致优化项目，通过重构数据流、优化渲染机制及建立性能标准，提升用户交易体验与系统稳定性，目标将核心性能指标超越竞品 20%。
## 技术栈
+ 框架与语言：Next.js（SSR+ISR 混合渲染）、TypeScript（类型安全开发）
+ 状态与数据流：MobX（状态管理）、RXJS（异步数据流处理）、SWR（数据缓存与实时更新）
+ 工程化与工具：ESLint（代码规范）、qiankun（微前端集成）、workbox（PWA 离线缓存）
+ UI 与交互：Tailwind CSS（原子化样式）、styled-components（组件样式隔离）、ahooks（高频 hooks 封装）
+ 业务工具：big.js（高精度数字计算）、i18next（多语言适配）
## 主要职责与技术实现
1. 性能标准体系建立与监控闭环
制定多维度性能标准：加载阶段（FCP≤800ms、LCP≤1.5s）、运行时（INP≤100ms）、视觉稳定性（CLS≤0.05）、资源体积（首屏 JS≤150KB），覆盖现货 / 合约等不同交易场景。
2. 搭建实时监控链路：集成 Web Vitals SDK 采集核心指标，通过 Next.js API Routes 上报至监控平台，结合自定义 Performance API 埋点（如订单提交响应时间、图表渲染耗时），实现 “指标异常 - 模块定位 - 根因分析” 闭环。
3. 核心指标优化方案落地
+ 加载性能优化：
采用 Next.js SSR 预渲染交易页骨架屏，结合 ISR（增量静态再生）缓存非实时内容（如导航、帮助入口），FCP 提升 40%；
+ 基于 workbox 实现 PWA 离线缓存，将静态资源（CSS / 图片）缓存至 Service Worker，重复访问加载速度提升 60%；
+ 实施代码分割：通过next/dynamic懒加载非首屏模块（如历史订单、手续费计算器），首屏 JS 体积从 320KB 压缩至 120KB。
+ 渲染与交互优化：
针对行情数据（每秒 3-5 次推送）：用 RXJS 实现数据流节流与防抖，通过distinctUntilChanged过滤重复数据，配合 MobX 的observable.shallow减少状态订阅触发，图表模块重渲染频率降低 70%；
+ 订单薄模块（高频更新）：采用虚拟列表（基于 ahooks 的useVirtualList）只渲染可视区 50 条数据，结合 DOM diff 优化，滚动流畅度提升至 60fps；
交互响应优化：将订单提交、价格输入等高频操作迁移至 Web Worker 处理（如 big.js 高精度计算），避免主线程阻塞，INP 从 180ms 优化至 80ms。
视觉稳定性优化：固定图表、订单薄容器尺寸，通过 Tailwind 的content-visibility: auto减少布局偏移；
数据流与模块重构
+ 重构状态管理：将全局状态拆分为 “行情域”“订单域”“用户域”，通过 MobX 模块化隔离，避免单 store 过大导致的牵一发而动全身，模块间通信通过 RXJS Subject 实现松耦合事件订阅，状态更新效率提升 50%；
+ 微前端改造：基于 qiankun 将交易页拆分为 “行情组件”“交易表单”“资产面板” 等独立子应用，支持单独部署与更新，迭代周期从 7 天缩短至 2 天；
+ 组件性能优化：通过React.memo 自定义比较函数减少无意义重渲染，用useMemo缓存计算密集型结果（如 K 线技术指标），内存占用降低 35%。
## 工作成果
+ 核心性能指标全面超越目标：FCP 720ms（提升 45%）、LCP 1.3s（提升 38%）、INP 75ms（提升 58%）、CLS 0.02（提升 83%），性能指标优于头部竞品 25%；
+ 建立 “性能标准 - 监控 - 优化 - 复盘” 方法论，沉淀为团队《交易页性能优化指南》，已应用于 3 个新业务线，复用率达 80%；
+ 高频交易场景（如合约平仓）响应速度提升 60%，用户投诉率下降 42%，核心交易页转化率提升 3.5%。

## 深度图实现
1. Canvas 绘制，分别展示买盘量与卖盘量。
2. 快照+增量更新，初次加载时全量获取数据，后续通过 WebSocket 实时推送增量数据，动态更新图表。
    - 初始化：
        1. 前端接收 books (snapshot) 数据，解析为 bids/asks 数组，记录当前 timestamp。
        2. 初始化 Canvas 图表，设置 buy/sell 两个面积图。
    - 增量更新：
        1. 前端持续接收 delta updates，严格校验顺序，按 price 排序。
        2. applyDelta 到 bids/asks Map 中，合并相同 price 下的数量。
        3. 对 bids/asks 数组排序，截断前 100 档，计算累积量。
        4. 调用 Canvas 更新 buy/sell 面积图。
3. 计算累积数量
4. 更新渲染
5. 性能优化：
    - 增量更新时，仅更新变化的 price 对应的 buy/sell 数据，避免全量重绘。
    - 虽然订单簿更新频率高，但视觉上每秒 30 次刷新已足够流畅，因此前端会对渲染逻辑进行节流（如每 33ms 执行一次），减少无效计算。
    - 订单簿数据的合并、累计数量计算等耗时操作放在 WebWorker 中执行，避免阻塞主线程的渲染流程，确保界面不卡顿
    - 深度图仅展示前 100 档
```typescript
WebSocket: books (snapshot)
↓
前端记录 bids/asks + timestamp
↓
持续接收 delta updates
↓
严格校验顺序
↓
applyDelta → merge into Map
↓
排序 + 截断前100档
↓
累积量计算
↓
绘制 depth 图
↓
(若丢包) 重拉 snapshot
```

## k线图
K 线图，原名蜡烛图，又称阴阳图、棒线、红黑线或蜡烛线，常用于展示股票/虚拟货币交易数据。K 线就是指将各种股票每日、每周、每月的开盘价、收盘价、最高价、最低价等涨跌变化状况，用图形的方式表现出来

和深度图类似：快照 + 增量推送 + 丢包检测