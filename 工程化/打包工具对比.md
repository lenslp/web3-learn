# 前端打包工具深度对比分析：Rollup vs Vite vs Webpack vs TSC vs Tsup

## 1. 核心对比总览

| 工具 | 核心定位 | 底层机制 | 构建速度 | Tree-shaking | 适用场景 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **Webpack** | 全能应用打包 | Loader + Plugin 体系 | 慢（大型项目） | 较好 | 大型复杂 Web 应用、老旧项目迁移 |
| **Rollup** | JS 库打包 | ESM 标准 | 快 | 优秀（标杆） | 类库（Library）、SDK、框架开发 |
| **Vite** | 现代应用开发 | 开发环境 esbuild + 生产环境 Rollup | 极快（开发时） | 优秀（依赖 Rollup） | 现代 Web 应用（SPA/MPA）、组件库预览 |
| **TSC** | TS 编译与类型检查 | TypeScript 编译器 | 慢 | 无（仅转译） | 类型检查、生成 .d.ts、纯 TS 转 JS |
| **Tsup** | 零配置 TS 库打包 | esbuild | 极快 | 一般 | 小型 TS 库、CLI 工具、Node.js 服务 |

---

## 2. 详细分析

### Webpack
*   **定位**：模块打包器（Module Bundler），前端工程化的基石。
*   **优点**：
    *   生态极其丰富，拥有海量的 Loaders 和 Plugins。
    *   功能最强大，几乎可以处理任何类型的资源（JS, CSS, 图片, 字体等）。
    *   代码分割（Code Splitting）功能非常成熟。
*   **缺点**：
    *   配置极其复杂，学习曲线陡峭。
    *   构建速度相对较慢，尤其是大型项目。
    *   产物代码包含较多运行时（Runtime）代码，不如 Rollup 简洁。

### Rollup
*   **定位**：新一代 JS 模块打包器，专注于 ESM。
*   **优点**：
    *   **Tree-shaking**：最早提出并实现了最高效的 Tree-shaking，能有效消除未使用的代码。
    *   **产物简洁**：生成的代码非常干净，几乎没有多余的运行时代码，非常适合开发库。
    *   支持多种输出格式（ESM, CJS, UMD）。
*   **缺点**：
    *   对非 JS 资源（如 CSS、图片）的处理不如 Webpack 开箱即用，需要插件支持。
    *   代码分割（Code Splitting）功能在早期不如 Webpack 强大（现已改进）。

### Vite
*   **定位**：下一代前端开发与构建工具。
*   **特点**：
    *   **开发环境**：利用浏览器原生 ESM 能力，实现秒级启动和热更新（HMR），速度与项目复杂度无关。使用 esbuild 预构建依赖。
    *   **生产环境**：使用 Rollup 进行打包，保证产物的优化和兼容性。
*   **优点**：开发体验极佳，配置简单，生态发展迅速。
*   **缺点**：生产环境依赖 Rollup，如果 Rollup 无法处理的复杂场景，Vite 也会受限（虽然很少见）。

### TSC (TypeScript Compiler)
*   **定位**：TypeScript 官方编译器。
*   **特点**：主要职责是**类型检查**和**转译**（Transpile）。
*   **局限**：
    *   不具备打包（Bundle）能力（不能把多个文件合并成一个，除非使用 outdated 的 prepend 选项）。
    *   不处理非 JS/TS 文件。
    *   编译速度较慢。
*   **常见用法**：通常与其他打包工具配合使用，或者仅用于生成类型定义文件（`.d.ts`）。

### Tsup
*   **定位**：基于 esbuild 的零配置 TypeScript 打包工具。
*   **特点**：
    *   **极速**：底层使用 Go 编写的 esbuild，构建速度比 Rollup/Webpack 快 10-100 倍。
    *   **零配置**：开箱即用，支持 `.ts`, `.tsx`, `.js`, `.jsx`。
    *   自带类型定义生成（基于 `rollup-plugin-dts` 或 `tsc`）。
*   **适用**：非常适合快速开发不需要复杂资源处理（如 CSS Modules 等复杂 CSS 处理）的 Node.js 工具、CLI 或纯 JS/TS 库。

---

## 3. 最佳实践与选型指南

### 场景一：开发大型 Web 应用（SPA/MPA）
*   **首选**：**Vite**
    *   理由：开发体验最好，构建速度快，配置简单，社区插件丰富。
*   **备选**：**Webpack**
    *   理由：如果项目依赖某些特定的 Webpack Loader，或者需要极度精细的构建控制（如微前端特定架构、极其复杂的拆包策略）。

### 场景二：开发通用的 JavaScript/TypeScript 库（Library / SDK）
*   **首选**：**Rollup**
    *   理由：产物最干净，Tree-shaking 效果最好，支持导出多种模块格式，兼容性好。
*   **替代（追求速度）**：**Tsup**
    *   理由：如果是纯 TS/JS 库，不需要处理复杂的 CSS/Assets，Tsup 能提供极速的开发构建体验。

### 场景三：开发 Node.js CLI 工具或后端服务
*   **首选**：**Tsup**
    *   理由：构建速度极快，原生支持 TypeScript，配置极其简单。
*   **备选**：**esbuild**（直接使用）
    *   理由：极致速度，但配置相对原始。

### 场景四：Monorepo 项目
*   **推荐组合**：
    *   **TurboRepo / Nx** 作为任务调度。
    *   **Vite** 用于应用（Apps）构建。
    *   **Tsup / Rollup** 用于内部包（Packages）构建。

## 4. 常见搭配模式

1.  **Vite + TSC**：Vite 负责构建和开发服务器（使用 esbuild 转译 TS，不检查类型），TSC 仅运行 `tsc --noEmit` 负责类型检查。
2.  **Rollup + Babel**：经典组合，用于确保库的兼容性。
3.  **Tsup**：内部集成了 esbuild 和 rollup-plugin-dts，通常单独使用即可满足库的打包和类型生成。
