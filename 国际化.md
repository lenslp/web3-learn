## 一、i18next + Smartling 集成流程
1️⃣ Smartling 作为翻译平台
1. 源语言文案的上传与同步（例如 en.json）
2. 翻译与审核流程（人工翻译 + 机器翻译）
3. 多语言支持（包括语言和地区，如 zh-TW, en-US, ar-SA 等）
4. 与 Git 或 CI/CD 集成：自动将翻译文件回推到版本控制平台（GitHub/GitLab）

在此过程中，Gate.io 会通过 Smartling API 自动同步翻译文件，所有的翻译文案都存储在 Smartling 上，然后通过 GitHub 或 GitLab 自动同步到开发仓库。

2️⃣ i18next 用于前端国际化
1. 在 Gate.io 中，i18next 的任务是 动态加载翻译文件 和 提供语言切换功能。
2. i18next 会从 CDN 或服务器加载翻译文件，路径大致如下：
```typescript
i18n.use(HttpBackend)
  .init({
    lng: 'zh-TW', // 当前语言（通过URL或用户设置）
    fallbackLng: 'en', // 默认语言
    backend: {
      loadPath: 'https://cdn.gate.io/locales/{{lng}}/{{ns}}.json', // 动态加载翻译文件
    },
    interpolation: {
      escapeValue: false, // 不需要转义
    },
  });
```
3. 模块化翻译资源：i18next 支持将翻译文件按模块划分，例如 trade.json、account.json、futures.json 等。这样，前端应用只加载所需的部分翻译资源，而不是一次性加载所有语言包，提升了性能。
4. 支持异步加载：通过 i18next-http-backend 插件，翻译文件在运行时动态加载，而不是在页面加载时就全部请求，进一步优化性能。

## 二、如何实现实时翻译更新
1. 当新的翻译内容通过 Smartling 平台完成后，它会自动回推到 GitHub 或 GitLab 的翻译文件。这些翻译文件会包含 en.json、zh-TW.json、ar.json 等。
2. CI/CD 流程会自动构建和压缩这些 JSON 文件，然后将它们上传到 CDN。
    + 例如，CDN 路径为：https://cdn.gate.io/locales/zh-TW/futures.json
3. 语言包版本控制与 CDN 缓存
    + 语言包文件名通常会包含哈希值，例如 zh.4984.f776a9aa8cd76bbea818.js，这有助于防止 CDN 缓存问题，确保用户加载最新的翻译文件。
4. 前端动态更新语言包
    + 当用户切换语言时，i18next 会动态加载相应语言的 JSON 文件并更新页面文本。
    + i18next 支持通过 changeLanguage() 方法动态切换语言，加载对应语言包。
5. 热更新语言包
    + 如果翻译文件有更新，i18next 可以使用版本号或哈希值来确保前端始终加载到最新的翻译文件，而无需刷新页面。

  ## 如何实现根据用户所在地区显示对应的语言
  1. 根据navigator.language获取用户浏览器的语言设置，或者通过IP地址推断用户所在地区
  2. 在中间件中重定向，在URL中加上/zh-cn或/en等前缀
```typescript
// pages/_app.tsx
import { useEffect } from "react";
import { useRouter } from "next/router";
import { appWithTranslation } from 'next-i18next';

const MyApp = ({ Component, pageProps }) => {
  const router = useRouter();

  useEffect(() => {
    const userLanguage = navigator.language || navigator.userLanguage;
    const locale = userLanguage.startsWith("zh") ? "zh" : "en"; // 根据浏览器语言选择语言
    if (locale !== router.locale) {
      router.push(router.pathname, router.asPath, { locale }); // 自动切换语言
    }
  }, [router]);

  return <Component {...pageProps} />;
};

export default appWithTranslation(MyApp);
```